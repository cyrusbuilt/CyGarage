
var Timer statusTimer = null
val String fileName = "cygarage.rules"

rule "CyGarageRecCmdON"
when
    Item CyGarage received command
then
    logInfo(fileName, "Garage door received command.")
    sendHttpGetRequest("http://<your_ip_here>/device/status")
end

rule "CyGarageOPEN_AJAR_15"
when
    System started or Item CyGarageStatus changed
then
    if (CyGarageStatus.state != "CLOSED") {
        logInfo(fileName, "Garage door is OPEN or AJAR!")
        statusTimer = createTimer(now.plusMinutes(15), [|
            logInfo(fileName, "Garage door has been left AJAR or OPEN for 15 minutes!")
            sendBroadcastNotification("Garage door has been left AJAR or OPEN for 15 minutes!")
        ])
    }
    else {
        logInfo(fileName, "Garage door is CLOSED.")
        if (statusTimer !== null) {
            statusTimer = null
        }
    }
end